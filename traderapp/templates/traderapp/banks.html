{% extends 'base.html' %}
{% load static %}
{% block title %}–ö–æ—à–µ–ª—å–∫–∏ - Treagle{% endblock %}

{% block content %}
<div class="container">
  <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞–º–∏</h2>


  <div class="actions">
    <button class="stylish-btn" onclick="openAddWalletModal()">–î–æ–±–∞–≤–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</button>
    <button class="stylish-btn" onclick="toggleFilterMenu()">–§–∏–ª—å—Ç—Ä—ã</button>
</div>

<!-- –ú–µ–Ω—é —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
<form method="POST" action="{% url 'wallets' %}" id="filter-form">
  {% csrf_token %}
  <div id="filter-menu" class="filter-menu hidden">
    <h5>–§–∏–ª—å—Ç—Ä—ã</h5>
    <div class="mb-2">
      <label for="filter_bank">–ë–∞–Ω–∫</label>
      <select class="form-select" name="bank" id="filter_bank">
        <option value="">–í—Å–µ</option>
        <option value="tinkoff" {% if request.POST.bank == 'tinkoff' %}selected{% endif %}>–¢–∏–Ω—å–∫–æ—Ñ—Ñ</option>
        <option value="sber" {% if request.POST.bank == 'sber' %}selected{% endif %}>–°–±–µ—Ä–±–∞–Ω–∫</option>
        <option value="mts" {% if request.POST.bank == 'mts' %}selected{% endif %}>–ú–¢–° –ë–∞–Ω–∫</option>
        <option value="gazprombank" {% if request.POST.bank == 'gazprombank' %}selected{% endif %}>–ì–∞–∑–ø—Ä–æ–º–±–∞–Ω–∫</option>
        <option value="vtb" {% if request.POST.bank == 'vtb' %}selected{% endif %}>–í–¢–ë</option>
        <option value="akbars" {% if request.POST.bank == 'akbars' %}selected{% endif %}>–ê–∫ –ë–∞—Ä—Å</option>
      </select>
    </div>
    <div class="mb-2">
      <label for="filter_card_number">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</label>
      <input type="text" class="form-control" name="card_number" id="filter_card_number" placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã" value="{{ request.POST.card_number }}">
    </div>
    <div class="mb-2">
      <label for="filter_phone_number">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
      <input type="text" class="form-control" name="phone_number" id="filter_phone_number" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" value="{{ request.POST.phone_number }}">
    </div>
    <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
  </div>
</form>
<form method="POST" action="{% url 'wallets' %}" id="reset-filter-form" style="display: none;">
  {% csrf_token %}
</form>
{% if request.POST.bank or request.POST.card_number or request.POST.phone_number %}
  <div id="applied-filters" class="applied-filters" style="display: flex; align-items: center; margin-top: 10px;">
    <span style="font-style: italic; color: gray;">
      –ü—Ä–∏–º–µ–Ω–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä—ã: 
      {% if request.POST.bank %} {{ request.POST.bank }} {% endif %}
      {% if request.POST.card_number %} (–Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã) {% endif %}
      {% if request.POST.phone_number %} (–Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞) {% endif %}
    </span>
    <button id="reset-filters" style="background: none; border: none; color: red; margin-left: 5px;">‚úñ</button>
  </div>
{% endif %}





  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ -->
  <!-- –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ wallets - —ç—Ç–æ —Å–ø–∏—Å–æ–∫ –∫–æ—à–µ–ª—å–∫–æ–≤ -->
<div id="wallet-container" class="row">
  {% for wallet in wallets %}
  <div class="col-md-4 mb-3">
    <div class="card position-relative" data-bank="{{ wallet.bank }}" onclick="flipCard(this)">
      <div class="card-inner">
        <div class="card-front" style="background-color: {% if wallet.bank == 'tinkoff' %} #3b382b {% elif wallet.bank == 'sber' %} #006b10 {% elif wallet.bank == 'mts' %} #6d5555 {% elif wallet.bank == 'gazprombank' %} #1E90FF {% elif wallet.bank == 'vtb' %} #004B87 {% elif wallet.bank == 'akbars' %} #50C878 {% else %} #FFFFFF {% endif %};">
          <img src="{% if wallet.bank == 'tinkoff' %}{% static 'images/tinkoff_logo.png' %}{% elif wallet.bank == 'sber' %}{% static 'images/sber_logo.png' %}{% elif wallet.bank == 'mts' %}{% static 'images/mts_logo.png' %}{% elif wallet.bank == 'gazprombank' %}{% static 'images/gazprombank_logo.png' %}{% elif wallet.bank == 'vtb' %}{% static 'images/vtb_logo.png' %}{% elif wallet.bank == 'akbars' %}{% static 'images/akbars_logo.png' %}{% else %}{% static 'images/default_logo.png' %}{% endif %}" class="bank-logo {% if wallet.bank == 'tinkoff' %}tinkoff-logo{% elif wallet.bank == 'sber' %}sber-logo{% elif wallet.bank == 'mts' %}mts-logo{% elif wallet.bank == 'gazprombank' %}gazprombank-logo{% elif wallet.bank == 'vtb' %}vtb-logo{% elif wallet.bank == 'akbars' %}akbars-logo{% else %}default-logo{% endif %}" draggable="false">
          <h5 class="card-title">{{ wallet.owner_name }}</h5>
          <p class="card-text">
              <strong>–ö–∞—Ä—Ç–∞:</strong> {{ wallet.card_number }}<br>
              <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ wallet.description }}<br>
          </p>
          <button class="btn btn-warning" onclick="toggleWalletStatus({{ wallet.id }}, this)">
            {% if wallet.is_enabled %}–í—ã–∫–ª—é—á–∏—Ç—å{% else %}–í–∫–ª—é—á–∏—Ç—å{% endif %}
          </button>
          <button class="btn btn-secondary" onclick="flipCard(this)">‚ÜîÔ∏è</button>
      </div>
      <div class="card-back">
        <p>
            <strong>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:</strong> {{ wallet.phone_number }}<br>
            <strong>–õ–∏–º–∏—Ç —Å–¥–µ–ª–æ–∫:</strong> {{ wallet.limit_transactions_per_day }}<br>
            <strong>–õ–∏–º–∏—Ç –ø–æ —Å—É–º–º–µ:</strong> {{ wallet.limit_amount_per_day }}<br>
            <strong>–û–±–æ—Ä–æ—Ç:</strong> {{ wallet.total_turnover|default:"0.00" }}<br>
        </p>
        <div class="button-group">
            <button class="btn btn-danger" onclick="deleteWallet({{ wallet.id }})">–£–¥–∞–ª–∏—Ç—å</button>
            <button class="btn btn-info" onclick="showInfo({{ wallet.id }})">–ò–Ω—Ñ–æ</button>
            <button class="btn btn-warning" onclick="openEditWalletModal({{ wallet.id }})">üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å</button>
        </div>
        <button class="btn btn-secondary" onclick="flipCard(this)">‚ÜîÔ∏è</button>
        </div>    
      </div>
    </div>
  </div>
  {% empty %}
  <div class="col-12 text-center">
    <p>–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤.</p>
  </div>
  {% endfor %}
</div>




<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞ -->
<div id="walletModal" class="modal hidden" data-effect="expand-vert">
  <div class="modal-dialog">
    <div class="modal-header">
      <h4>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ/–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞</h4>
      <span class="close-modal" onclick="closeAddWalletModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="wallet-form" onsubmit="submitWalletForm(event)">
        <input type="hidden" id="wallet-id">
        <div class="mb-3">
          <label for="bank" class="form-label">–ë–∞–Ω–∫</label>
          <select class="form-select" id="bank" required>
            <option value="tinkoff">–¢–∏–Ω—å–∫–æ—Ñ—Ñ</option>
            <option value="sber">–°–±–µ—Ä–±–∞–Ω–∫</option>
            <option value="mts">–ú–¢–° –ë–∞–Ω–∫</option>
            <option value="gazprombank">–ì–∞–∑–ø—Ä–æ–º–±–∞–Ω–∫</option>
            <option value="vtb">–í–¢–ë</option>
            <option value="akbars">–ê–∫ –ë–∞—Ä—Å</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="card_number" class="form-label">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</label>
          <input type="text" class="form-control" id="card_number" required>
        </div>
        <div class="mb-3">
          <label for="phone_number" class="form-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
          <input type="text" class="form-control" id="phone_number">
        </div>
        <div class="mb-3">
          <label for="account_number" class="form-label">–ù–æ–º–µ—Ä —Å—á–µ—Ç–∞</label>
          <input type="text" class="form-control" id="account_number">
        </div>
        <div class="mb-3">
          <label for="owner_name" class="form-label">–§–ò–û –≤–ª–∞–¥–µ–ª—å—Ü–∞</label>
          <input type="text" class="form-control" id="owner_name" required>
        </div>
        <div class="mb-3">
          <label for="description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
          <textarea class="form-control" id="description"></textarea>
        </div>
        <div class="mb-3">
          <label for="limit_transactions_per_day" class="form-label">–õ–∏–º–∏—Ç –∑–∞—è–≤–æ–∫ –≤ —Å—É—Ç–∫–∏</label>
          <input type="number" class="form-control" id="limit_transactions_per_day">
        </div>
        <div class="mb-3">
          <label for="limit_amount_per_day" class="form-label">–õ–∏–º–∏—Ç –ø–æ —Å—É–º–º–µ –≤ —Å—É—Ç–∫–∏</label>
          <input type="number" class="form-control" id="limit_amount_per_day">
        </div>
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="auto_disable_on_limit" onchange="toggleNotifyCheckbox()">
          <label class="form-check-label" for="auto_disable_on_limit">–ê–≤—Ç–æ–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ª–∏–º–∏—Ç–µ</label>
        </div>
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="notify_on_disable" disabled>
          <label class="form-check-label" for="notify_on_disable">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏</label>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeAddWalletModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </form>
    </div>
  </div>
</div>


<style>
  .actions {
    display: flex;
    gap: 1rem; /* –ü—Ä–æ–±–µ–ª –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ */
    margin-bottom: 20px; /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
  }

  .stylish-btn {
    background-color: #4CAF50; /* –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç –∫–Ω–æ–ø–∫–∏ */
    color: white; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
    border: none; /* –£–±–∏—Ä–∞–µ–º –æ–±–≤–æ–¥–∫—É */
    border-radius: 5px; /* –°–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ */
    padding: 10px 20px; /* –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
    font-size: 16px; /* –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
    cursor: pointer; /* –ö—É—Ä—Å–æ—Ä-—É–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    transition: background-color 0.3s, transform 0.2s; /* –ü–ª–∞–≤–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç */
  }

  .stylish-btn:hover {
    background-color: #45a049; /* –¢–µ–º–Ω—ã–π –æ—Ç—Ç–µ–Ω–æ–∫ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    transform: scale(1.05); /* –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
  }

/* –î–ª—è –∫–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π —Ü–≤–µ—Ç */
  .stylish-btn:nth-child(2) {
    background-color: #008CBA; /* –°–∏–Ω–∏–π —Ü–≤–µ—Ç –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
  }

  .stylish-btn:nth-child(2):hover {
    background-color: #007B9E; /* –¢–µ–º–Ω–µ–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
  }

  #wallet-container {
    display: flex;
    flex-wrap: wrap; /* –ü–æ–∑–≤–æ–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞–º –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É */
    justify-content: flex-start; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–æ –Ω–∞—á–∞–ª—É, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å space-between –¥–ª—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è */
  }

  .col-md-4 {
    flex: 1 1 calc(10% - 20px); /* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —à–∏—Ä–∏–Ω—É –¥–ª—è 4 –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ —Ä—è–¥ —Å —É—á–µ—Ç–æ–º –æ—Ç—Å—Ç—É–ø–æ–≤ */
    margin-bottom: 20px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É —Ä—è–¥–∞–º–∏ */
  }

  .card-inner {
    position: relative;
    border: 1px solid #9e9e9e; /* –ì—Ä–∞–Ω–∏—Ü–∞ —Ç–µ–ø–µ—Ä—å –∑–¥–µ—Å—å */
    border-radius: 8px;
    width: 100%;
    height: 100%;
    transition: transform 0.6s;
    transform-style: preserve-3d;
  }

  .card-front, .card-back {
    position: absolute;
    border-radius: 8px;
    width: 100%;
    height: 100%;
    backface-visibility: hidden; /* –°–∫—Ä—ã–≤–∞–µ—Ç –∑–∞–¥–Ω—é—é —á–∞—Å—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–µ */
  }

  .card-back {
    transform: rotateY(180deg); /* –ü–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –∑–∞–¥–Ω—é—é —á–∞—Å—Ç—å */
  }

  .card.flipped .card-inner {
    transform: rotateY(180deg); /* –ü–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É */
  }

  .card {
    perspective: 1000px; /* –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã */
    box-shadow: 0 0 10px rgba(112, 112, 112, 0.918);
    width: 324px; /* –®–∏—Ä–∏–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ */
    height: 203px; /* –í—ã—Å–æ—Ç–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ */
    margin-top: 15px;
    border-radius: 8px;
    overflow: hidden;
    transition: box-shadow 0.3s ease;
    position: relative; /* –¥–ª—è –∞–±—Å–æ–ª—é—Ç–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–æ—Ç–∏–ø–∞ */
  }


  .modal.hidden {
    display: none;
}

.modal {
    position: fixed;
    z-index: 2000;
    left: 50%;
    top: 50%;
    width: 100%;
    height: 100%;
    overflow: auto;
    display: flex; /* –î–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è */
    justify-content: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
    align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
    /* –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥—Ä—É–≥–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –Ω–∏–∂–µ –Ω–µ –º–µ—à–∞—é—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ */
}

.modal-dialog {
    background-color: #252525; /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤–æ–≥–æ –æ–∫–Ω–∞ */
    border-radius: 8px; /* –°–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ */
    padding: 20px; /* –û—Ç—Å—Ç—É–ø—ã –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
    box-shadow: 0 0 10px rgba(190, 190, 190, 0.445);
    border: 1px solid #ccc;
    width: 90%; /* –®–∏—Ä–∏–Ω–∞ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ */
    max-width: 500px; /* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
    margin: 0;  /* –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç—Å—Ç—É–ø—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç */
}


@keyframes expand-vert-animation {
    0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
    }
    100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
    }
}

@keyframes expand-vert-animation-out {
    0% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
    }
    100% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
    }
}

.modal.show {
    display: flex; /* –ò—Å–ø–æ–ª—å–∑—É–µ–º flex –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è */
    animation: expand-vert-animation 0.5s ease forwards;
}

.modal.hiding {
    animation: expand-vert-animation-out 0.25s ease forwards;
}

  .modal-content {
    background-color: #0a0a0a;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%; /* width of the modal */
    max-width: 500px; /* Max width for small screens */
  }

  .close-modal {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }

  .close-modal:hover,
  .close-modal:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }

  .bank-logo {
    width: 250px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –ª–æ–≥–æ—Ç–∏–ø–∞ */
    height: 250px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –ª–æ–≥–æ—Ç–∏–ø–∞ */
    object-fit: contain; /* –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω */
    position: absolute;
    top: 10px;
    right: 10px;
    opacity: 0.8; /* –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å */
    z-index: 1; /* –ß—Ç–æ–±—ã –ª–æ–≥–æ—Ç–∏–ø –±—ã–ª –Ω–∞–¥ –∫–∞—Ä—Ç–æ—á–∫–æ–π */
    user-select: none; /* –û—Ç–∫–ª—é—á–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
  }
  .tinkoff-logo {
    width: 200px; /* –®–∏—Ä–∏–Ω–∞ –ª–æ–≥–æ—Ç–∏–ø–∞ –¢–∏–Ω—å–∫–æ—Ñ—Ñ */
    height: auto; 
    right: -41px;
  }

  .sber-logo {
    width: 100px; /* –®–∏—Ä–∏–Ω–∞ –ª–æ–≥–æ—Ç–∏–ø–∞ –°–±–µ—Ä */
    height: auto;
  }

  .mts-logo {
    width: 90px; /* –®–∏—Ä–∏–Ω–∞ –ª–æ–≥–æ—Ç–∏–ø–∞ –ú–¢–° */
    height: auto;
  }

  .gazprombank-logo {
    width: 80px; /* –®–∏—Ä–∏–Ω–∞ –ª–æ–≥–æ—Ç–∏–ø–∞ –ì–∞–∑–ø—Ä–æ–º–±–∞–Ω–∫ */
    height: auto;
  }

  .vtb-logo {
    width: 90px; /* –®–∏—Ä–∏–Ω–∞ –ª–æ–≥–æ—Ç–∏–ø–∞ –í–¢–ë */
    height: auto;
  }

  .akbars-logo {
    width: 100px; /* –®–∏—Ä–∏–Ω–∞ –ª–æ–≥–æ—Ç–∏–ø–∞ –ê–∫ –ë–∞—Ä—Å */
    height: auto;
  }

  .default-logo {
    width: 70px;
    height: auto;
  }

  .card-body {
    height: calc(100% - 50px); /* –£–º–µ–Ω—å—à–∞–µ–º –≤—ã—Å–æ—Ç—É —Ç–µ–ª–∞ –∫–∞—Ä—Ç–æ—á–∫–∏, —á—Ç–æ–±—ã –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ –¥–ª—è –ª–æ–≥–æ—Ç–∏–ø–∞ */
    padding: 10px; /* –û—Ç—Å—Ç—É–ø—ã –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ */
    display: flex; 
    margin-top: 50px;
    flex-direction: column; /* –û—Ä–≥–∞–Ω–∏–∑—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
    justify-content: space-between; /* –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ */
  }


  .card:hover {
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.918);
  }

  .filter-menu.hidden {
    display: none;
  }

  .filter-menu {
    background-color: #252525;
    border: 1px solid #ccc;
    border-radius: 8px; /* –°–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ */
    padding: 10px;
    box-shadow: 0 0 10px rgba(190, 190, 190, 0.445);
    position: absolute; /* –ß—Ç–æ–±—ã –º–µ–Ω—é –æ—Ç–æ–±—Ä–∞–∂–∞–ª–æ—Å—å –ø–æ–≤–µ—Ä—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ */
    z-index: 100; /* –ü–æ–≤—ã—à–∞–µ–º —É—Ä–æ–≤–µ–Ω—å z-index */
  }

</style>

<script>

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞
  function deleteWallet(walletId) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–æ—à–µ–ª–µ–∫?')) {
        fetch(`/trade/wallets-delete/${walletId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken'),
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                // –£–¥–∞–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –∏–∑ DOM
                const walletElement = document.querySelector(`.card[data-wallet-id="${walletId}"]`);
                walletElement.remove();
            } else {
                alert(data.message);
            }
        })
        .catch((error) => {
            console.error('–û—à–∏–±–∫–∞:', error);
        });
    }
  }

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∫–æ—à–µ–ª—å–∫–∞
  function toggleWalletStatus(walletId, buttonElement) {
    fetch(`/trade/wallets-update-status/${walletId}/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken'),
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            // –ò–∑–º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
            buttonElement.textContent = data.is_enabled ? '–í—ã–∫–ª—é—á–∏—Ç—å' : '–í–∫–ª—é—á–∏—Ç—å';
        } else {
            alert(data.message);
        }
    })
    .catch((error) => {
        console.error('–û—à–∏–±–∫–∞:', error);
    });
  }


  function flipCard(button) {
    const cardInner = button.closest('.card-inner'); // –ù–∞—Ö–æ–¥–∏–º –±–ª–∏–∂–∞–π—à–∏–π —ç–ª–µ–º–µ–Ω—Ç card-inner
    cardInner.parentElement.classList.toggle('flipped'); // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∫–ª–∞—Å—Å flipped –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ card
  }


  function openEditWalletModal(walletId) {
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ—à–µ–ª—å–∫–µ –ø–æ –µ–≥–æ ID (—Å–¥–µ–ª–∞–µ–º AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö)
    fetch(`/trade/wallets-get/${walletId}/`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const wallet = data.wallet;
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∫–æ—à–µ–ª—å–∫–∞
                document.getElementById('wallet-id').value = wallet.id; // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ç—É —Å—Ç—Ä–æ–∫—É –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ ID
                document.getElementById('bank').value = wallet.bank;
                document.getElementById('card_number').value = wallet.card_number;
                document.getElementById('phone_number').value = wallet.phone_number;
                document.getElementById('account_number').value = wallet.account_number;
                document.getElementById('owner_name').value = wallet.owner_name;
                document.getElementById('description').value = wallet.description;
                document.getElementById('limit_transactions_per_day').value = wallet.limit_transactions_per_day;
                document.getElementById('limit_amount_per_day').value = wallet.limit_amount_per_day;
                document.getElementById('auto_disable_on_limit').checked = wallet.auto_disable_on_limit;
                document.getElementById('notify_on_disable').checked = wallet.notify_on_disable;

                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                openAddWalletModal();
            } else {
                alert(data.message);
            }
        })
        .catch((error) => {
            console.error('–û—à–∏–±–∫–∞:', error);
        });
  }


  function openAddWalletModal() {
    const modal = document.getElementById('walletModal');
    modal.classList.remove('hidden');
    modal.classList.add('show'); // –ü–æ–∫–∞–∑–∞—Ç—å —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
  }

  function closeAddWalletModal() {
    const modal = document.getElementById('walletModal');
    modal.classList.add('hiding'); // –ù–∞—á–∞—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é —Å–∫—Ä—ã—Ç–∏—è

    // –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Å–∫—Ä—ã—Ç—å
    setTimeout(() => {
        modal.classList.remove('show', 'hiding'); // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å—ã
        modal.classList.add('hidden'); // –£–±–∏—Ä–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    }, 250); // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Ä–µ–º—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–∞–π–º–∏–Ω–≥–æ–º –∞–Ω–∏–º–∞—Ü–∏–∏
  }

  window.onclick = function(event) {
    const modal = document.getElementById('walletModal');
    if (event.target == modal) {
        closeAddWalletModal();
    }
  }



  function showInfo(walletId) {
    // –ó–¥–µ—Å—å –º–æ–∂–µ—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ—à–µ–ª—å–∫–µ
    alert("–ü–æ–∫–∞–∑–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ—à–µ–ª—å–∫–µ —Å ID: " + walletId);
  }
  function toggleFilterMenu() {
    const filterMenu = document.getElementById('filter-menu');
    filterMenu.classList.toggle('hidden'); // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ñ–∏–ª—å—Ç—Ä–∞
  }

  function applyFilters() {
    const bank = document.getElementById('filter_bank').value;
    const cardNumber = document.getElementById('filter_card_number').value.trim();
    const phoneNumber = document.getElementById('filter_phone_number').value.trim();

    const allWallets = document.querySelectorAll('#wallet-container .card');
    let hasAppliedFilters = false; // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è, –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã

    allWallets.forEach(wallet => {
        const walletBank = wallet.getAttribute('data-bank');
        const walletNumber = wallet.querySelector('.card-text strong:nth-child(1)').nextSibling.textContent.trim();
        const walletPhone = wallet.querySelector('.card-text strong:nth-child(2)').nextSibling.textContent.trim();

        const matchesBank = !bank || walletBank === bank;
        const matchesCardNumber = !cardNumber || walletNumber.includes(cardNumber);
        const matchesPhoneNumber = !phoneNumber || walletPhone.includes(phoneNumber);

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–ª–∏ —Å–∫—Ä—ã–≤–∞–µ–º –∫–æ—à–µ–ª–µ–∫
        if (matchesBank && matchesCardNumber && matchesPhoneNumber) {
            wallet.parentElement.style.display = 'block';
        } else {
            wallet.parentElement.style.display = 'none';
        }

        // –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ñ–∏–ª—å—Ç—Ä –ø—Ä–∏–º–µ–Ω–µ–Ω (–Ω–µ –≤—ã–±—Ä–∞–Ω–æ "–í—Å–µ" –∏ –µ—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è), –∑–Ω–∞—á–∏—Ç, –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ñ–∏–ª—å—Ç—Ä
        if (wallet.parentElement.style.display === 'block') {
            hasAppliedFilters = true;
        }
    });

    // –£–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –æ–±–ª–∞—Å—Ç–∏ —Å –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
    const appliedFiltersElement = document.getElementById('applied-filters');
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–∞–∫–æ–π-–ª–∏–±–æ —Ñ–∏–ª—å—Ç—Ä –≤—ã–±—Ä–∞–Ω
    appliedFiltersElement.style.display = hasAppliedFilters ? 'flex' : 'none';
    
    // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ "–í—Å–µ", —Å–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    if (bank === "") {
        appliedFiltersElement.style.display = 'none'; // –°–∫—Ä—ã—Ç—å –±–ª–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    }
}
// –ò–∑–º–µ–Ω—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–±—Ä–æ—Å–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
  document.getElementById('reset-filters').addEventListener('click', function() {
    document.getElementById('reset-filter-form').submit();
    document.getElementById('applied-filters').style.display = 'none'; // –°–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∏–ª—å—Ç—Ä–∞—Ö
    applyFilters();
  });


  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  function submitWalletForm(event) {
    event.preventDefault();
    const walletId = document.getElementById('wallet-id').value || ""; // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ID –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    const walletData = {
        id: walletId, // –î–æ–±–∞–≤–ª—è–µ–º ID –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        card_number: document.getElementById('card_number').value,
        phone_number: document.getElementById('phone_number').value,
        account_number: document.getElementById('account_number').value,
        owner_name: document.getElementById('owner_name').value,
        description: document.getElementById('description').value,
        limit_transactions_per_day: document.getElementById('limit_transactions_per_day').value,
        limit_amount_per_day: document.getElementById('limit_amount_per_day').value,
        auto_disable_on_limit: document.getElementById('auto_disable_on_limit').checked,
        notify_on_disable: document.getElementById('notify_on_disable').checked,
        bank: document.getElementById('bank').value
    };

    fetch('/trade/wallets-add/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken'),
        },
        body: JSON.stringify(walletData),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message); // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞
            closeAddWalletModal();
            location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            // Logic for updating the wallet in the DOM or adding it
        } else {
            alert(data.message);
        }
    })
    .catch((error) => {
        console.error('–û—à–∏–±–∫–∞:', error);
    });
}

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  function toggleNotifyCheckbox() {
    const autoDisableCheckbox = document.getElementById('auto_disable_on_limit');
    const notifyCheckbox = document.getElementById('notify_on_disable');
    notifyCheckbox.disabled = !autoDisableCheckbox.checked; // –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ —á–µ–∫–±–æ–∫—Å–∞
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ CSRF
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
</script>
{% endblock %}
